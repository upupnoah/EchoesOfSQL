# 外键和连接：如何做关联查询？

Course name: MySQL 必知必会
ID: LEARN-GEEK-32
Parent item: 实践 (https://www.notion.so/0b1a2094985641b4b4b7a9009bdb9565?pvs=21)
Status: In progress

> 将分散在多个不同的表中的数据查询出来的操作，就是**多表查询**
> 

MySQL 中，为了把 2 个表关联起来，会用到 2 个重要功能：

1. 外键（FOREIGN KEY）→ 创建表的时候 or 修改表
2. 连接（JOIN）→ 在查询阶段

# 创建外键

- 外键就是**从表**中用来引用**主表**中数据的那个**公共字段**
    
    ![https://static001.geekbang.org/resource/image/68/ae/68836a01eb1d667dea93ceda8e5714ae.jpg?wh=3276*1262](https://static001.geekbang.org/resource/image/68/ae/68836a01eb1d667dea93ceda8e5714ae.jpg?wh=3276*1262)
    
- 语法
    
    ```sql
    [CONSTRAINT <外键约束名称>] FOREIGN KEY 字段名
    REFERENCES <主表名> 字段名
    ```
    
- 例子
    
    ```sql
    CREATE TABLE 从表名
    (
      字段名 类型,
      ...
    -- 定义外键约束，指出外键字段和参照的主表字段
    CONSTRAINT 外键约束名
    FOREIGN KEY (字段名) REFERENCES 主表名 (字段名)
    )
    ```
    
    ```sql
    ALTER TABLE 从表名 ADD CONSTRAINT 约束名 FOREIGN KEY 字段名 REFERENCES 主表名 （字段名）;
    ```
    
    一般情况下在设计表的时候就确定了，因此在创建表的时候会指定好外键
    

# 连接

## 内连接（INNER JOIN）

> 查询结果**只返回符合连接条件的记录**，这种连接方式比较常用
> 
- JOIN 关键字与 ON 关键字配对使用
    
    ```sql
    select a.transactionno, a.itemnumber, a.quantity, a.price, a.transdate, b.membername
    from demo.trans as a
             join demo.membermaster AS b on (a.cardno = b.cardno);
    ```
    

## 外连接（OUTER JOIN）

> 表示查询结果**返回某一个表中的所有记录**，以及**另一个表中满足连接条件的记录**
> 

### 左连接（LEFT JOIN）

> 返回左边表中的所有记录，以及右表中符合连接条件的记录
> 

```sql
select a.transactionno,a.itemnumber, a.quantity,a.price,a.transdate,b.membername
from demo.trans as a
         left join demo.membermaster as b on (a.cardno = b.cardno);
```

### 右连接（RIGHT JOIN）

> 返回右边表中的所有记录，以及左表中符合连接条件的记录
> 

```sql
select a.transactionno,a.itemnumber, a.quantity,a.price,a.transdate,b.membername
from demo.membermaster as b
    right join demo.trans as a on (a.cardno = b.cardno);
```

## 关联查询的误区

在 MySQL 中，外键约束不是关联查询的必要条件，**但是很多人认为外键约束太麻烦，没有必要❌**

- 外键约束可以保证数据的一致性
- 但是外键约束的**开销比较大**，**最好在应用层面保证数据一致性**